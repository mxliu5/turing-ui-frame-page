import{$ as t,u as B,a as G,g as H}from"./index-23dc409e.js";import{g as F,a7 as Q,y as O,r as _,M as q,K as L,j as m,o as P,k as X,l as s,D as i,W as u,u as y,v as R,L as J,a8 as Y,a9 as ee,p as te,t as W}from"./vendor-285f3bb0.js";import{u as oe}from"./useTablePage-ba306b4f.js";function z(d){return t("tip.formatError")+"："+t("tip.onlySupport")+d}const U=t("tip.nameValidateTip"),le=t("tip.codeValidateTip"),ae=z(U),ne=z(le),se=/^[a-zA-Z0-9_\s\-\u4e00-\u9fa5]+$/;function re(d){return d?se.test(d):!0}const ie=/^[a-zA-Z0-9_-\s]+$/;function ue(d){return d?ie.test(d):!0}const de=()=>({validateNameRule:(g,c,n,p)=>{if(c==="")return n(new Error(p));if(re(c))n();else return n(new Error(ae))},validateCodeRule:(g,c,n,p)=>{if(c==="")return n(new Error(p));if(ue(c))n();else return n(new Error(ne))}}),pe=F({__name:"add",emits:["reload"],setup(d,{expose:f,emit:g}){const{proxy:c}=B(),{t:n}=Q(),{api:p}=G(),k=O(()=>x.value==="add"?n("btn.new"):n("btn.edit")),w=O(()=>x.value==="edit"),h=_(!1),$=()=>{b.value.resetForm(),h.value=!1},A=()=>{b.value.submitForm(a=>{a&&(w.value,console.log("params",e.value))})},{validateNameRule:I}=de(),x=_("add"),b=_(null),v={id:void 0,name:"",appId:"",customText:"",city:[],date:"",age:"",enable:!1,school:"北京大学",hobby:[],file:null};let e=_(q({},v));const o=L({name:[{required:!0,trigger:"blur",validator:(a,l,N)=>I(a,l,N,"请输入模版名称")}],appId:[{required:!0,message:"请选择类型",trigger:"change"}],file:[{required:!0,message:"请上传文件",trigger:"change"}]}),r=_({name:{label:"名称",type:"input",attrs:{maxlength:30,placeholder:U}},appId:{label:"应用",type:"select",options:[],attrs:{clearable:!1},events:{change:a=>{console.log(a)}}},city:{label:"城市",type:"cascader",options:[],attrs:{props:{checkStrictly:!0,value:"code",label:"name",children:"children"}}},date:{label:"日期",type:"date"},age:{label:"年龄",type:"inputNumber",attrs:{min:1,max:100,step:1}},enable:{label:"是否启用",type:"switch"},school:{label:"学校",type:"radio",options:[{value:"北京大学",label:"北京大学"},{value:"清华大学",label:"清华大学"},{value:"复旦大学",label:"复旦大学"}]},hobby:{label:"爱好",type:"checkbox",options:[{value:"唱歌",label:"唱歌"},{value:"跳舞",label:"跳舞"},{value:"羽毛球",label:"羽毛球"},{value:"游泳",label:"游泳"},{value:"跑步",label:"跑步"}]},customText:{label:"描述",type:"textarea",attrs:{maxlength:50}},file:{label:"上传文件",type:"slot",slotName:"file"}}),D=async a=>{const l=await p.getAppOptions(a);r.value.appId.options=l.list,r.value.appId.attrs.remote=l.total>p.MAX_TOTAL},S=async()=>{const a=await p.getCityOptions();r.value.city.options=a},T=()=>{D(),S()},V=async(a,l)=>{console.log(a,l),x.value=a,h.value=!0,T(),J(()=>{a==="edit"?e.value=Y(l,ee(v)):(e.value=q({},v),c.$refs.uploadRef.clearFiles())})},C=()=>{console.log("下载模版")};return f({openDialog:V}),(a,l)=>{const N=m("tu-button"),j=m("my-upload"),K=m("my-form"),Z=m("my-drawer");return P(),X(Z,{class:"mock-add",modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=E=>h.value=E),title:k.value,onConfirm:A,onClose:$},{default:s(()=>[i(K,{ref_key:"formRef",ref:b,rules:o,ruleForm:u(e),formItems:r.value},{file:s(()=>[i(j,{ref:"uploadRef",maxSize:"10M",accept:".xls,.xlsx",modelValue:u(e).file,"onUpdate:modelValue":l[0]||(l[0]=E=>u(e).file=E),drag:"","drag-style":"",showDownload:"",onDownload:C},{tips:s(()=>l[3]||(l[3]=[y("div",{class:"upload-tips"},[y("p",null,"1、文件内容格式请参照模版，一行一条测试数据，一条数据最多支持5000字"),y("p",null,"2、每条任务最多支持2000条数据，超出部分不予导入"),y("p",null,"3、仅支持扩展名为：.xlsx/xls文件；大小不超过10M"),y("p",null,"4、上传后，可在任务列表等待审核结果，仅支持下载查看详情")],-1)])),default:s(()=>[i(N,{type:"primary",plain:""},{default:s(()=>l[2]||(l[2]=[R("上传文件")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["rules","ruleForm","formItems"])]),_:1},8,["modelValue","title"])}}}),ce={class:"mock-list"},me={style:{display:"inline-block",color:"red","margin-left":"5px"}},M="mock-demo",ge=F({__name:"list",setup(d){const{$app:f,proxy:g,$router:c}=B(),{query:n,queryItems:p,searchQuery:k,selectedIds:w,handleSelectionChange:h}=oe(M);p.value={city:{label:"城市",modelValue:[],type:"el-cascader",options:[{code:"anhui",name:"安徽",children:[{code:"hefei",name:"合肥"},{code:"fuyang",name:"阜阳"},{code:"tongning",name:"铜陵"}]},{code:"jiangsu",name:"江苏",children:[{code:"nanjing",name:"南京"},{code:"suzhou",name:"苏州"},{code:"wuxi",name:"无锡"}]}],attrs:{props:{checkStrictly:!0,value:"code",label:"name",children:"children"}}},keywords:{type:"el-input",label:t("common.keywordSearch"),showAppend:!0,attrs:{placeholder:t("placeholder.searchByKey")}}};const $=_([{prop:"name",label:t("common.name"),minWidth:180,showOverflowTooltip:!1,custom:"editInput",customRender:{blur:e=>{console.log("当前行",e),v()}}},{prop:"appId",label:"APPID",withCopy:!0,width:280,showOverflowTooltip:!1},{prop:"type",label:t("common.type"),minWidth:150,custom:"tag-status",customRender:{options:{1:{type:"danger",name:"黑名单"},2:{type:"primary",name:"白名单"}},tagAttrs:{size:"small",round:!0}}},{prop:"status",label:t("common.status"),minWidth:150,custom:"status",customRender:{options:{1:{type:"success",name:"已发布"},2:{type:"info",name:"未发布"},3:{type:"danger",name:"已驳回"},4:{type:"warning",name:"上线审核中"},5:{type:"primary",name:"下线审核中"}},tips:e=>e.rejectReason}},{prop:"enable",label:t("common.enableOrNot"),minWidth:150,custom:"switch",customRender:{disabled:e=>e.status===1,beforeChange:e=>new Promise((o,r)=>{e.enable===1?f.$confirm({title:"确定禁用？"}).then(()=>{o(!0)}).catch(()=>{r()}):o(!0)})}},{prop:"num",label:"关联数量",minWidth:100,custom:"link",customRender:{disabled:e=>e.num===0,click:e=>{console.log(e)},attrs:{font:{fontWeight:600}}}},{prop:"customText",label:"自定义插槽11",custom:"slot",minWidth:280},{prop:"date",label:t("common.updateTime"),minWidth:180},{prop:"operation",label:t("common.operation"),width:180,fixed:"right"}]),A=[{type:"detail",label:t("btn.detail")},{type:"edit",label:t("btn.edit")},{type:"delete",label:t("btn.delete"),btnType:"danger",disabled:e=>e.status===3,disabledTips:"已发布状态不支持删除！",collapsed:!0},{type:"publish",label:t("btn.publish"),exist:e=>[2,3].includes(e.status),collapsed:!0},{type:"offline",label:t("btn.offline"),exist:e=>e.status===1,collapsed:!0}],I=e=>e.map(o=>o),x=e=>{const{type:o,record:r}=e;b[o](r)},b=L({add:()=>{var e;(e=g.$refs.addRef)==null||e.openDialog("add")},batchDelete:()=>{f.$deleteConfirm({title:"确认删除选中的模版"}).then(()=>{console.log("删除的项",w.value)})},detail:e=>{c.push({name:`${M}::detail`,params:{id:e.id}})},edit:e=>{var o;(o=g.$refs.addRef)==null||o.openDialog("edit",e)},delete:e=>{f.$deleteConfirm({title:t("tip.deleteConfirmTitle",{t:"模版名称",n:e.name})}).then(()=>{console.log("删除",e),f.$message.warning("接口待提供！")})},publish:e=>{f.$confirm({title:"确定发布当前模版？"}).then(()=>{console.log("发布",e)}).catch(()=>{})}}),v=()=>{g.$refs.myTableRef.loadData()};return(e,o)=>{const r=m("tu-button"),D=m("Service"),S=m("el-icon"),T=m("tu-tooltip"),V=m("TablePage");return P(),te("div",ce,[i(V,{ref:"myTableRef",query:u(n),queryItems:u(p),queryAttrs:{labelColon:!1},operationAttrs:{selectedTotal:u(w).length},columns:$.value,operations:A,"with-order":!1,"with-selection":"","selection-option":{selectable:C=>C.status!==1,"reserve-selection":!0},tableAttrs:{"row-key":"id"},loadDataApi:u(H),transformListData:I,onHandleOperation:x,onSelectionChange:u(h),onSearch:u(k)},{buttonGroup:s(()=>[i(r,{type:"add",onClick:b.add},{default:s(()=>o[0]||(o[0]=[R("新建模版")])),_:1},8,["onClick"]),i(r,{type:"delete",tooltipButton:{clickable:u(w).length>0,handle:"删除"},onClick:b.batchDelete},{default:s(()=>o[1]||(o[1]=[R(" 批量删除 ")])),_:1},8,["tooltipButton","onClick"])]),customText:s(C=>[i(S,null,{default:s(()=>[i(D)]),_:1}),y("span",me,W(C.row.customText),1)]),"status-header":s(()=>[R(W(u(t)("common.status")),1),i(T,{content:"状态的相关提示信息"})]),"customText-header":s(()=>[o[2]||(o[2]=y("b",{style:{color:"blue"}},"自定义头部",-1)),i(T,{content:"当前列的头部内容自定义名称以prop-header命名"})]),_:1},8,["query","queryItems","operationAttrs","columns","selection-option","loadDataApi","onSelectionChange","onSearch"]),i(pe,{ref:"addRef",onReload:v},null,512)])}}});export{ge as default};
